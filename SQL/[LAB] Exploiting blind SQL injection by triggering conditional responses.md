# Lab: Blind SQL injection with conditional responses

### Link: https://portswigger.net/web-security/sql-injection/blind/lab-conditional-responses
![Require of Lab](/Images/sql11.1.png)

Yêu cầu của bài lab là đăng nhập bằng thông tin của user `administrator`



Đối với blind SQLi, thì điểm khó ở đây là ta sẽ không nhận được các phản hồi chứa kết quả của câu truy vấn hoặc là chi tiết của lỗi.
Do đó, để giải quyết bài lab này ta chỉ có thể dựa trên một số thông báo được hiện ra khi thực hiện câu truy vấn có trả về kết quả.
Ở bài lab này đó là thông báo `Welcome back`

Đầu tiên mở Burp Suite, chuyển sang tab `Proxy` > `Intercept` > `Open Browser`. Truy cập vào bài lab bằng trình duyệt của Burp Suite

Vào bài lab ta thấy đây là 1 website bán hàng, với từng danh mục như `Corporate gifts`, `Food & Drink`, `Gifts` và `Lifestyle`, `Pets`....
![Website](/Images/sql11.2.png)

Sau đó, bấm vào một danh mục tùy ý 
![Website](/Images/sql11.4.png)

và ở Burp chọn tab `HTTP history`, lựa chọn request mới nhất, tiếp theo click chuột phải vô request đó và chọn `Send to Repeater`
![Website](/Images/sql11.5.png)

Chuyển sang tab `Repeater`, ta có thể thấy được TrackingId của request là `P1KSrLlojPy1Pbou`.
Chỉnh sửa TrackingId thành
> TrackingId =P1KSrLlojPy1Pbou`'+AND+'1'='1`

bấm `Send` để gửi request và xem phản hồi
![Website](/Images/sql11.6.png)

Khi ta gửi request, nó sẽ truy vấn như sau 
> SELECT TrackingId FROM Tracking-TABLE WHERE TrackingId='P1KSrLlojPy1Pbou' AND '1'='1'

Bởi vì TrackingId = P1KSrLlojPy1Pbou có tồn tại và 1 = 1 là luôn luôn đúng, nên phản hồi trả về sẽ xuất hiện `Welcome back`

Tiếp tục chỉnh sửa TrackingId thành
> TrackingId`'+AND+'1'='2`

bấm `Send` để gửi request và xem phản hồi

Khi ta gửi request, nó sẽ truy vấn như sau 
> SELECT TrackingId FROM Tracking-TABLE WHERE TrackingId='P1KSrLlojPy1Pbou' AND '1'='2'

Bởi vì TrackingId = P1KSrLlojPy1Pbou có tồn tại nhưng 1 = 2 là biểu thức sai, nên phản hồi trả về sẽ không xuất hiện `Welcome back`
![Website](/Images/sql11.7.png)

Bước tiếp theo là xác định xem bảng user có trong database hay không, ta sẽ kiểm tra như sau
Thay đổi TrackingId thành như sau
>  TrackingId`'+AND+(SELECT+'a'+FROM+users+LIMIT+1)='a`

Đổi thành câu truy vấn là 
> SELECT TrackingId FROM Tracking-TABLE WHERE TrackingId='P1KSrLlojPy1Pbou' AND (SELECT 'a' FROM users LIMIT 1) ='a

Có nghĩa là, ngoài việc kiểm tra TrackingID có tồn tại, thì ta sẽ kiểm tra thêm một biểu thức boolean có đung hay không.
Nếu đúng thì sẽ xác nhận là bảng users có tồn tại trong dtb
![Website](/Images/sql11.8.png)

Sau khi xác nhận trong dtb có tồn tại bảng user, bởi vì yêu cầu rằng phải đăng nhập bằng thông tin của user `administrator` nên ta phải kiểm tra
user này có tồn tại hay không như sau
> TrackingId`'+AND+(SELECT+'a'+FROM+users+WHERE+username='administrator')='a`
![Website](/Images/sql11.9.png)

Bước tiếp theo, ta sẽ kiểm tra độ dài password của user administrator
> TrackingId`'+AND+(SELECT+'a'+FROM+users+WHERE+username='administrator'+AND+LENGTH(password)=1)='a`

Click chuột phải `Request` và lựa chọn `Send to Intruder`
![Website](/Images/sql11.10.png)

Chuyển sang tab `Intruder`, trước tiên chọn `Clear $`
![Website](/Images/sql11.11.png)

Sau đó, highlight số `1` ở `LENGTH(password)=1)` và bấm `Add $`

Chuyển sang tab `Payload`, ở phần **Payload Sets** lựa chọn **Payload type** là **Numbers** , 
sau đó ở phần **Payload Options** ta cho số chạy từ 1 đến 50 với bước nhảy là 1 và cuối cùng là bấm **Start attack**
![Website](/Images/sql11.13.png)

Ở phần payload = 20, phản hồi có chứa `Welcome back`. Từ đó ta xác định được độ dài của password là 20 ký tự
![Website](/Images/sql11.14.png)

Sau khi xác định được độ dài password, ta tiến hành đoán password bằng cách brute forcer

Quay lại `Repeater`, chỉnh sửa TrackingID thành
> TrackingId`'+AND+(SELECT+SUBSTRING(password,1,1)+FROM+users+WHERE+username%3d'administrator')%3d'a`

Click chuột phải và chọn `Send to Intruder`
![Website](/Images/sql11.16.png)

Chuyển sang tab `Intruder`, bấm Clear $ và hightlight số `1` đầu tiên ở `SUBSTRING(password,1,1)` và bấm `Add $`; tiếp tục highlight ký tự `a` ở `='a` cuối câu và bấm `Add $`.
Cuối cùng, bấm chọn **Attack type** là **Cluster bomb**
![Website](/Images/sql11.17.png)

Ở tab `Payload`, đầu tiên ở phần **Payload Sets** lựa chọn **Payload set** là 1 và **Payload type** là **Numbers**, 
sau đó ở phần **Payload Options** ta cho số chạy từ 1 đến 20 với bước nhảy là 1.
![Website](/Images/sql11.18.png)

Tiếp theo, tiếp tục chọn ở phần **Payload Sets** lựa chọn **Payload set** là 2 và **Payload type** là **Brute forcer**, 
sau đó ở phần **Payload Options** ta để độ dài tối thiểu và tối đa là 1 và bấm **Start attack**
![Website](/Images/sql11.19.png)

Kiểm tra phản hồi chứa `Welcome back`, ta nhìn sang payload 1 là vị trí payload 2 là ký tự password và sắp xếp theo thứ tự để tìm ra password
![Website](/Images/sql11.20.png)

Dựa vào kết quả tấn công, ta tìm được password là `se3plxjifdxpplokgu37 `

Sau đó, dùng password đã tìm được thực hiện đăng nhập vào website bằng username `administrator` là đã hoàn thành bài lab rồi


<div align="right"> <i> Ngày 22 tháng 01 năm 2022 </i> </div>
